CREATE MATERIALIZED VIEW trips_interval AS
 SELECT taxi_zone.Zone as pickup_zone, taxi_zone_1.Zone as dropoff_zone, tpep_pickup_datetime, tpep_dropoff_datetime, tpep_dropoff_datetime - tpep_pickup_datetime AS trip_interval
 FROM trip_data
 JOIN taxi_zone ON trip_data.PULocationID = taxi_zone.location_id
 JOIN taxi_zone as taxi_zone_1 ON trip_data.DOLocationID = taxi_zone_1.location_id;
 
 SELECT pickup_zone, dropoff_zone, count(1), min(trip_interval), max(trip_interval), avg(trip_interval)
 FROM trips_interval
 GROUP BY pickup_zone, dropoff_zone
 ORDER BY avg DESC;
 
 -----------------------------------------
 
CREATE MATERIALIZED VIEW latest_17hours_trip_data AS (
WITH max_pickup_datetime AS (SELECT MAX(tpep_pickup_datetime) max FROM trip_data)
 SELECT taxi_zone.Zone as pickup_zone, taxi_zone_1.Zone as dropoff_zone, tpep_pickup_datetime, tpep_dropoff_datetime
 FROM max_pickup_datetime, trip_data
 JOIN taxi_zone ON trip_data.PULocationID = taxi_zone.location_id
 JOIN taxi_zone as taxi_zone_1 ON trip_data.DOLocationID = taxi_zone_1.location_id
 WHERE tpep_pickup_datetime > max - interval '17 hours');
 
 SELECT pickup_zone, COUNT(1) AS pickup_count
 FROM latest_17hours_trip_data
 GROUP BY pickup_zone
 ORDER BY pickup_count DESC
 LIMIT 3;